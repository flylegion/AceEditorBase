<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Monaco Editor</title>
    <style>
      html, body, #container {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background-color: #1e1e1e;
      }

      #container {
        transform: scale(0.75);
        transform-origin: top left;
        width: 133.33%;
        height: 133.33%;
      }
    </style>
  </head>
  <body>
    <!-- ðŸ‘‡ Input oculto para activar teclado en Android -->
    <textarea id="fakeInput" style="position:absolute;opacity:0;height:0;width:0;z-index:-1;"></textarea>

    <div id="container"></div>

    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
    <script>
      require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs' }});
      require(['vs/editor/editor.main'], function () {
        window.editor = monaco.editor.create(document.getElementById('container'), {
          value: '',
          language: 'javascript',
          theme: 'vs-dark',
          fontSize: 12,
        });

        // ðŸ‘‡ FunciÃ³n para activar teclado en Android
        const triggerAndroidKeyboard = () => {
          const fakeInput = document.getElementById('fakeInput');
          if (fakeInput) {
            fakeInput.focus();
            setTimeout(() => {
              editor.focus();
            }, 100);
          }
        };

        // ðŸ‘‡ Al enfocar el editor, activar teclado y enviar mensaje a React Native
        editor.onDidFocusEditorText(() => {
          triggerAndroidKeyboard();

          if (window.ReactNativeWebView) {
            window.ReactNativeWebView.postMessage('focused');
          }
        });

        // ðŸ‘‡ Escuchar mensajes desde React Native
        window.addEventListener('message', function(event) {
          try {
            const data = JSON.parse(event.data);

            if (data.type === 'SET_CODE' && typeof data.payload === 'string') {
              editor.setValue(data.payload);
              editor.focus();
            }

            if (data.type === 'SELECT_ALL') {
              const model = editor.getModel();
              if (model) {
                const fullRange = model.getFullModelRange();
                editor.setSelection(fullRange);
                editor.focus();
              }
            }
          } catch (e) {
            console.error('Error al procesar mensaje:', e);
          }
        });
      });
    </script>
  </body>
</html>
